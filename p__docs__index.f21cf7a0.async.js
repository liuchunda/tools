"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[287],{18661:function(Ee,Y,a){a.r(Y),a.d(Y,{default:function(){return Ce}});var re=a(17384),ae=a.n(re),ne=a(78095),k=a.n(ne),se=a(60430),z=a.n(se),te=a(53939),g=a.n(te),ue=a(83134),T=a.n(ue),ie=a(34827),S=a.n(ie),b=a(82702),le=a(38964),de=a(61507),ce=a(78058),E=a(45925),X=a(48238),A=a(55963),oe=a(66099),$=a(40670),fe=a(25592),me=a(35452),W=a(22745),x=a(4512),pe=a(61383),ve=a(76109),he=a(64722),ge=a(12583),D={pdfItemWrapper:"pdfItemWrapper___acdCd",pdfItemCard:"pdfItemCard___cJbtf",deleteButton:"deleteButton___ekUBv",pdfItemContent:"pdfItemContent___mF2DW",pdfThumbnail:"pdfThumbnail___iMIq8",pdfPlaceholder:"pdfPlaceholder___FuqaL",pdfIcon:"pdfIcon___IQPpR",pdfInfo:"pdfInfo___YGiSU",pdfName:"pdfName___PuqqQ",pdfPages:"pdfPages___D3Duv"},r=a(97616),De=function(N){var o=N.item,p=N.index,y=N.moveItem,M=N.removeItem,U=(0,pe.c)({type:"pdf-item",item:{index:p},collect:function(j){return{isDragging:j.isDragging()}},canDrag:!o.loading}),L=S()(U,2),C=L[0].isDragging,B=L[1],G=(0,ve.L)({accept:"pdf-item",hover:function(j){j.index!==p&&(y(j.index,p),j.index=p)}}),H=S()(G,2),Q=H[1],J=C?.5:1;return(0,r.jsx)("div",{ref:function(j){return B(Q(j))},style:{opacity:J},className:D.pdfItemWrapper,children:(0,r.jsxs)(A.Z,{className:D.pdfItemCard,hoverable:!o.loading,children:[!o.loading&&(0,r.jsx)($.ZP,{type:"text",danger:!0,size:"small",className:D.deleteButton,icon:(0,r.jsx)(ge.Z,{}),onClick:function(){return M(o.id)}},"delete"),(0,r.jsxs)("div",{className:D.pdfItemContent,children:[(0,r.jsx)("div",{className:D.pdfThumbnail,children:o.loading?(0,r.jsx)("div",{className:D.pdfPlaceholder,children:(0,r.jsx)(he.Z,{size:"large"})}):o.thumbnail?(0,r.jsx)("img",{src:o.thumbnail,alt:o.name}):(0,r.jsx)("div",{className:D.pdfPlaceholder,children:(0,r.jsx)("div",{className:D.pdfIcon,children:"PDF"})})}),(0,r.jsx)("div",{className:D.pdfInfo,children:(0,r.jsx)("div",{className:D.pdfName,title:o.name,children:o.name})})]})]})})},Pe=De;x.Tu.workerSrc="/pdf.worker.min.mjs";var Fe=ce.Z.Title,je=function(){var N=(0,b.useState)([]),o=S()(N,2),p=o[0],y=o[1],M=(0,b.useState)(!1),U=S()(M,2),L=U[0],C=U[1],B=(0,b.useRef)(new Set),G=function(){var i=T()(g()().mark(function s(t){var l,u,I,n,d,f,m,P,v;return g()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.arrayBuffer();case 3:return l=e.sent,u=x.Me({data:l}),e.next=7,u.promise;case 7:return I=e.sent,e.next=10,I.getPage(1);case 10:if(n=e.sent,d=1.5,f=n.getViewport({scale:d}),m=document.createElement("canvas"),P=m.getContext("2d"),P){e.next=17;break}return e.abrupt("return","");case 17:return m.height=f.height,m.width=f.width,v={canvasContext:P,viewport:f,canvas:m},e.next=22,n.render(v).promise;case 22:return e.abrupt("return",m.toDataURL("image/png"));case 25:return e.prev=25,e.t0=e.catch(0),console.error("\u751F\u6210\u7F29\u7565\u56FE\u5931\u8D25:",e.t0),e.abrupt("return","");case 29:case"end":return e.stop()}},s,null,[[0,25]])}));return function(t){return i.apply(this,arguments)}}(),H=function(){var i=T()(g()().mark(function s(t){var l,u;return g()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,t.arrayBuffer();case 3:return l=n.sent,n.next=6,W.PDFDocument.load(l);case 6:return u=n.sent,n.abrupt("return",u.getPageCount());case 10:return n.prev=10,n.t0=n.catch(0),console.error("\u8BFB\u53D6 PDF \u5931\u8D25:",n.t0),n.abrupt("return",0);case 14:case"end":return n.stop()}},s,null,[[0,10]])}));return function(t){return i.apply(this,arguments)}}(),Q=(0,b.useCallback)(function(){var i=T()(g()().mark(function s(t){var l,u;return g()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(l=t.fileList,u=[],l.forEach(function(d){if(d.status==="done"||d.originFileObj){var f=d.originFileObj||d;f&&f.type==="application/pdf"&&u.push(f)}}),u.length>0){C(!0);try{y(function(d){var f=new Set(d.map(function(e){return"".concat(e.name,"-").concat(e.file.size)})),m=u.filter(function(e){var h="".concat(e.name,"-").concat(e.size);return f.has(h)||B.current.has(h)?!1:(B.current.add(h),!0)});if(m.length===0)return C(!1),d;var P=m.map(function(e){return{id:"".concat(Date.now(),"-").concat(Math.random(),"-").concat(e.name),file:e,name:e.name,pages:0,loading:!0}}),v=[].concat(z()(d),z()(P)),K=m.map(function(){var e=T()(g()().mark(function h(F,be){var w,_,ee;return g()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return w=P[be].id,c.prev=1,c.next=4,H(F);case 4:return _=c.sent,c.next=7,G(F);case 7:return ee=c.sent,y(function(O){return O.map(function(Z){return Z.id===w?k()(k()({},Z),{},{thumbnail:ee,pages:_,loading:!1}):Z})}),c.abrupt("return",{success:!0,file:F});case 12:return c.prev=12,c.t0=c.catch(1),console.error("\u5904\u7406\u6587\u4EF6 ".concat(F.name," \u5931\u8D25:"),c.t0),y(function(O){var Z=O.find(function(V){return V.id===w});if(Z){var Ze="".concat(Z.name,"-").concat(Z.file.size);B.current.delete(Ze)}return O.filter(function(V){return V.id!==w})}),E.ZP.error("\u5904\u7406\u6587\u4EF6 ".concat(F.name," \u5931\u8D25")),c.abrupt("return",{success:!1,file:F});case 18:case"end":return c.stop()}},h,null,[[1,12]])}));return function(h,F){return e.apply(this,arguments)}}());return Promise.allSettled(K).then(function(){C(!1),y(function(e){var h=e.filter(function(F){return!F.loading&&F.pages>0}).length;return h>0&&E.ZP.success("\u6210\u529F\u6DFB\u52A0 ".concat(h," \u4E2A PDF \u6587\u4EF6")),e})}),v})}catch(d){E.ZP.error("\u5904\u7406 PDF \u6587\u4EF6\u5931\u8D25"),console.error(d),C(!1)}}case 4:case"end":return n.stop()}},s)}));return function(s){return i.apply(this,arguments)}}(),[]),J=(0,b.useCallback)(function(i,s){y(function(t){var l=z()(t),u=l.splice(i,1),I=S()(u,1),n=I[0];return l.splice(s,0,n),l})},[]),R=(0,b.useCallback)(function(i){y(function(s){var t=s.find(function(u){return u.id===i});if(t){var l="".concat(t.name,"-").concat(t.file.size);B.current.delete(l)}return s.filter(function(u){return u.id!==i})})},[]),j=(0,b.useCallback)(T()(g()().mark(function i(){var s,t,l,u,I,n,d,f,m,P,v;return g()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(p.length!==0){e.next=3;break}return E.ZP.warning("\u8BF7\u5148\u4E0A\u4F20 PDF \u6587\u4EF6"),e.abrupt("return");case 3:return C(!0),e.prev=4,e.next=7,W.PDFDocument.create();case 7:s=e.sent,t=ae()(p),e.prev=9,t.s();case 11:if((l=t.n()).done){e.next=25;break}return u=l.value,e.next=15,u.file.arrayBuffer();case 15:return I=e.sent,e.next=18,W.PDFDocument.load(I);case 18:return n=e.sent,e.next=21,s.copyPages(n,n.getPageIndices());case 21:d=e.sent,d.forEach(function(h){s.addPage(h)});case 23:e.next=11;break;case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(9),t.e(e.t0);case 30:return e.prev=30,t.f(),e.finish(30);case 33:return e.next=35,s.save();case 35:f=e.sent,m=new Blob([f.buffer],{type:"application/pdf"}),P=URL.createObjectURL(m),v=document.createElement("a"),v.href=P,v.download="\u5408\u5E76\u7684PDF_".concat(new Date().getTime(),".pdf"),document.body.appendChild(v),v.click(),document.body.removeChild(v),URL.revokeObjectURL(P),E.ZP.success("PDF \u5408\u5E76\u6210\u529F\uFF01"),e.next=52;break;case 48:e.prev=48,e.t1=e.catch(4),E.ZP.error("\u5408\u5E76 PDF \u5931\u8D25"),console.error(e.t1);case 52:return e.prev=52,C(!1),e.finish(52);case 55:case"end":return e.stop()}},i,null,[[4,48,52,55],[9,27,30,33]])})),[p]);return(0,r.jsx)(le.W,{backend:de.PD,children:(0,r.jsxs)("div",{className:"pdf-combine-container",children:[(0,r.jsx)(Fe,{level:2,children:"PDF \u5408\u5E76\u5DE5\u5177"}),(0,r.jsxs)(X.Z,{direction:"vertical",size:"large",style:{width:"100%"},children:[(0,r.jsx)(A.Z,{children:(0,r.jsx)(oe.Z,{multiple:!0,accept:".pdf",fileList:[],beforeUpload:function(){return!1},onChange:Q,showUploadList:!1,children:(0,r.jsx)($.ZP,{icon:(0,r.jsx)(fe.Z,{}),loading:L,children:"\u4E0A\u4F20 PDF \u6587\u4EF6\uFF08\u53EF\u591A\u9009\uFF09"})})}),p.length>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(A.Z,{children:(0,r.jsx)("div",{className:"pdf-list",children:p.map(function(i,s){return(0,r.jsx)(Pe,{item:i,index:s,moveItem:J,removeItem:R},i.id)})})}),(0,r.jsx)(A.Z,{children:(0,r.jsxs)(X.Z,{children:[(0,r.jsx)($.ZP,{type:"primary",icon:(0,r.jsx)(me.Z,{}),onClick:j,loading:L,size:"large",children:"\u5408\u5E76\u5E76\u4E0B\u8F7D PDF"}),(0,r.jsxs)("div",{className:"merge-info",children:["\u5171 ",p.length," \u4E2A\u6587\u4EF6\uFF0C\u603B\u8BA1 ",p.reduce(function(i,s){return i+s.pages},0)," \u9875"]})]})})]})]})]})})},Ie=je,ye=function(){return(0,r.jsx)("div",{children:(0,r.jsx)(Ie,{})})},Ce=ye}}]);
